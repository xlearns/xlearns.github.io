{"version":3,"file":"PreView.3058e1f1.js","sources":["../../src/utils/index.js","../../src/components/BigScreen/FullScreen/FullSreen.vue","../../src/views/PreView.vue"],"sourcesContent":["\n\nexport function debounce(delay, callback) {\n  let task\n  return function() {\n    clearTimeout(task)\n    task = setTimeout(() => {\n      callback.apply(this, arguments)\n    }, delay)\n  }\n}\n\nexport function $(el){\n  return document.querySelector(el)\n}\n\n\nexport function isNumber(val){\n  return typeof val == 'number' && !isNaN(val)\n}\n\nexport function sleep(timer){\n  return new Promise(resolve=>{setTimeout(resolve,timer)})\n}\n\nexport function formatNumber(num,decimals,decimal,separator,prefix,suffix){\n  num = num.toFixed(decimals)\n  num += ''\n  const x = num.split('.')\n  let x1 = x[0]\n  const x2 = x.length > 1 ? decimal + x[1] : ''\n  const rgx = /(\\d+)(\\d{3})/\n  if(separator&&!isNumber(separator)){\n    while (rgx.test(x1)) {\n      x1 = x1.replace(rgx, '$1' + separator + '$2')\n    }\n  }\n  return prefix + x1 + x2 + suffix\n}","<template>\n  <div ref=\"dom\" class=\"datav-full-sreen\">\n    <template v-if=\"ready\">\n      <slot></slot>\n    </template>\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted, nextTick, onUnmounted } from \"vue\";\nimport { debounce } from \"@/utils\";\nexport default {\n  name: \"VFullSreen\",\n  props: {\n    options: Object,\n  },\n  setup(props) {\n    let dom = ref();\n    let width = ref(0);\n    let height = ref(0);\n    let originalWidth = ref(0);\n    let originalHeight = ref(0);\n    let ready = ref(false);\n    let observer;\n    const updateScale = function () {\n      // 获取真实的视口尺寸\n      const currentWidth = document.body.clientWidth;\n      const currentHeight = document.body.clientHeight;\n      // 获取大屏最终的宽高\n      const realWidth = width.value || originalWidth.value;\n      const realHeight = height.value || originalHeight.value;\n      const widthScale = currentWidth / realWidth;\n      const heightScale = currentHeight / realHeight;\n      dom.value &&\n        (dom.value.style.transform = `scale(${widthScale}, ${heightScale})`);\n    };\n    const updateSize = function () {\n      if (width.value && height.value) {\n        dom.value.style.width = `${width.value}px`;\n        dom.value.style.height = `${height.value}px`;\n      } else {\n        dom.value.style.width = `${originalWidth.value}px`;\n        dom.value.style.height = `${originalHeight.value}px`;\n      }\n    };\n    const init = function () {\n      return new Promise((resolve) => {\n        nextTick(() => {\n          if (props.options && props.options.width && props.options.height) {\n            width.value = props.options.width;\n            height.value = props.options.height;\n          } else {\n            console.warn(\n              \"props.options.width||props.options.height no defined\"\n            );\n            width.value = dom.value.clientWidth;\n            height.value = dom.value.clientHeight;\n          }\n          // 视口宽度\n          if (!originalWidth.value || !originalHeight.value) {\n            originalWidth.value = window.screen.width;\n            originalHeight.value = window.screen.height;\n          }\n          resolve();\n        });\n      });\n    };\n    const onResize = async function () {\n      // 屏幕改变、分辨率改变都会触发\n      await init();\n      updateScale();\n    };\n\n    const initMutationObserver = function () {\n      const MutationObserver = window.MutationObserver;\n      // dom变化执行onResize【callback】\n      observer = new MutationObserver(onResize);\n      observer.observe(dom.value, {\n        attributes: true,\n        attributeFilter: [\"style\"],\n        attributeOldValue: true,\n      });\n    };\n    const removeMutationObserver = function () {\n      if (observer) {\n        observer.disconnect();\n        observer.takeRecords();\n        observer = null;\n      }\n    };\n\n    onMounted(async () => {\n      ready.value = false;\n      await init();\n      updateSize();\n      updateScale();\n      window.addEventListener(\"resize\", debounce(100, onResize));\n      initMutationObserver();\n      ready.value = true;\n    });\n\n    onUnmounted(() => {\n      window.removeEventListener(\"resize\", onResize);\n      removeMutationObserver();\n    });\n\n    return {\n      ready,\n      dom,\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.datav-full-sreen {\n  position: fixed;\n  top: 0;\n  left: 0;\n  overflow: hidden;\n  transform-origin: left top;\n  z-index: 999;\n}\n</style>\n","<script setup>\nimport { usePanel } from \"@/hooks/usePanel\";\nimport { onMounted, onUnmounted, ref } from \"vue\";\nimport PreDiv from \"@/components/PreDiv/index.vue\";\nimport { useStyle } from \"@/hooks/useStyleSider\";\nimport FullScreen from \"@/components/BigScreen/FullScreen/FullSreen.vue\";\nimport router from \"@/router\";\nimport { ElMessage } from \"element-plus\";\nlet { list, rootStyle } = usePanel();\nlet { bgImg } = useStyle();\nlet options = ref(rootStyle.value);\n\nfunction goback(e) {\n  let { key } = e;\n  router.push(\"/\");\n}\nonMounted(() => {\n  ElMessage.success(\"按任意键返回\");\n  window.addEventListener(\"keydown\", goback);\n});\nonUnmounted(() => {\n  window.removeEventListener(\"keydown\", goback);\n});\n</script>\n\n<template>\n  <FullScreen :options=\"options\">\n    <div class=\"containerBox\" :style=\"{ backgroundImage: `url(${bgImg})` }\">\n      <PreDiv\n        v-for=\"item in list\"\n        :key=\"item.id\"\n        :w=\"item.w\"\n        :h=\"item.h\"\n        :x=\"item.x\"\n        :y=\"item.y\"\n        :z=\"item.z\"\n      >\n        <component\n          :is=\"item.component\"\n          :value=\"item.value\"\n          :styles=\"item.styles\"\n      /></PreDiv>\n    </div>\n  </FullScreen>\n</template>\n\n<style scoped>\n.containerBox {\n  position: relative;\n  height: 100%;\n  width: 100%;\n  background: no-repeat left top;\n  background-size: cover;\n  z-index: -9999;\n}\n</style>\n"],"names":["_sfc_main","_openBlock","_createElementBlock","_renderSlot"],"mappings":"ucAEO,WAAkB,EAAO,EAAU,CACxC,GAAI,GACJ,MAAO,WAAW,CAChB,aAAa,CAAI,EACjB,EAAO,WAAW,IAAM,CACtB,EAAS,MAAM,KAAM,SAAS,CAC/B,EAAE,CAAK,CACT,CACH,CCCA,KAAKA,GAAU,CACb,KAAM,aACN,MAAO,CACL,QAAS,MACV,EACD,MAAM,EAAO,CACX,GAAI,GAAM,IACN,EAAQ,EAAI,CAAC,EACb,EAAS,EAAI,CAAC,EACd,EAAgB,EAAI,CAAC,EACrB,EAAiB,EAAI,CAAC,EACtB,EAAQ,EAAI,EAAK,EACjB,EACJ,KAAM,GAAc,UAAY,CAE9B,KAAM,GAAe,SAAS,KAAK,YAC7B,EAAgB,SAAS,KAAK,aAE9B,EAAY,EAAM,OAAS,EAAc,MACzC,EAAa,EAAO,OAAS,EAAe,MAC5C,EAAa,EAAe,EAC5B,EAAc,EAAgB,EACpC,EAAI,OACD,GAAI,MAAM,MAAM,UAAY,SAAS,MAAe,OAEnD,EAAa,UAAY,CAC7B,AAAI,EAAM,OAAS,EAAO,MACxB,GAAI,MAAM,MAAM,MAAQ,GAAG,EAAM,UACjC,EAAI,MAAM,MAAM,OAAS,GAAG,EAAO,WAEnC,GAAI,MAAM,MAAM,MAAQ,GAAG,EAAc,UACzC,EAAI,MAAM,MAAM,OAAS,GAAG,EAAe,YAGzC,EAAO,UAAY,CACvB,MAAO,IAAI,SAAQ,AAAC,GAAY,CAC9B,EAAS,IAAM,CACb,AAAI,EAAM,SAAW,EAAM,QAAQ,OAAS,EAAM,QAAQ,OACxD,GAAM,MAAQ,EAAM,QAAQ,MAC5B,EAAO,MAAQ,EAAM,QAAQ,QAE7B,SAAQ,KACN,wDAEF,EAAM,MAAQ,EAAI,MAAM,YACxB,EAAO,MAAQ,EAAI,MAAM,cAGvB,EAAC,EAAc,OAAS,CAAC,EAAe,QAC1C,GAAc,MAAQ,OAAO,OAAO,MACpC,EAAe,MAAQ,OAAO,OAAO,QAEvC,GACF,CAAC,CACH,CAAC,GAEG,EAAW,gBAAkB,CAEjC,KAAM,GAAI,EACV,KAGI,EAAuB,UAAY,CACvC,KAAM,GAAmB,OAAO,iBAEhC,EAAW,GAAI,GAAiB,CAAQ,EACxC,EAAS,QAAQ,EAAI,MAAO,CAC1B,WAAY,GACZ,gBAAiB,CAAC,OAAO,EACzB,kBAAmB,EACrB,CAAC,GAEG,EAAyB,UAAY,CACzC,AAAI,GACF,GAAS,WAAU,EACnB,EAAS,YAAW,EACpB,EAAW,OAIf,SAAU,SAAY,CACpB,EAAM,MAAQ,GACd,KAAM,GAAI,EACV,IACA,IACA,OAAO,iBAAiB,SAAU,EAAS,IAAK,CAAQ,CAAC,EACzD,IACA,EAAM,MAAQ,EAChB,CAAC,EAED,EAAY,IAAM,CAChB,OAAO,oBAAoB,SAAU,CAAQ,EAC7C,GACF,CAAC,EAEM,CACL,QACA,MAEH,CACH,KA9GO,IAAI,MAAM,MAAM,4CAArB,MAAAC,GAAA,EAAAC,EAIM,MAJN,EAIM,CAHY,EAAK,MACnBC,EAAa,EAAA,OAAA,UAAA,CAAA,IAAA,CAAA,EAAA,OAAA,EAAA,6FCKnB,GAAI,CAAE,OAAM,aAAc,IACtB,CAAE,SAAU,IACZ,EAAU,EAAI,EAAU,KAAK,EAEjC,WAAgB,EAAG,CAEjB,EAAO,KAAK,GAAG,CACjB,CACA,SAAU,IAAM,CACd,EAAU,QAAQ,sCAAQ,EAC1B,OAAO,iBAAiB,UAAW,CAAM,CAC3C,CAAC,EACD,EAAY,IAAM,CAChB,OAAO,oBAAoB,UAAW,CAAM,CAC9C,CAAC"}